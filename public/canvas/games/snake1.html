<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snake Game</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
      }

      canvas {
        border: 1px solid #ccc;
        background-color: #fff;
      }
    </style>
  </head>
  <body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      const gridSize = 20;
      const snake = [{ x: 100, y: 100 }];
      let food = { x: 0, y: 0 };
      let dx = gridSize;
      let dy = 0;
      let changingDirection = false;
      let score = 0;

      function getRandomPosition() {
        return Math.floor(Math.random() * (canvas.width / gridSize)) * gridSize;
      }

      function drawSnake() {
        snake.forEach((segment, index) => {
          ctx.fillStyle = index === 0 ? "#4CAF50" : "#388E3C";
          ctx.fillRect(segment.x, segment.y, gridSize, gridSize);
          ctx.strokeStyle = "#fff";
          ctx.strokeRect(segment.x, segment.y, gridSize, gridSize);
        });
      }

      function moveSnake() {
        const head = { x: snake[0].x + dx, y: snake[0].y + dy };
        snake.unshift(head);
        if (head.x === food.x && head.y === food.y) {
          score += 10;
          document.getElementById("score").innerText = score;
          generateFood();
        } else {
          snake.pop();
        }
      }

      function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }

      function drawFood() {
        ctx.fillStyle = "#FF5722";
        ctx.fillRect(food.x, food.y, gridSize, gridSize);
        ctx.strokeStyle = "#fff";
        ctx.strokeRect(food.x, food.y, gridSize, gridSize);
      }

      function generateFood() {
        food.x = getRandomPosition();
        food.y = getRandomPosition();
        if (snake.some((segment) => segment.x === food.x && segment.y === food.y)) {
          generateFood(); // Regenerate food if it's inside the snake
        }
      }

      function changeDirection(event) {
        if (changingDirection) return;
        changingDirection = true;

        const keyPressed = event.key;
        const goingUp = dy === -gridSize;
        const goingDown = dy === gridSize;
        const goingRight = dx === gridSize;
        const goingLeft = dx === -gridSize;

        if (keyPressed === "ArrowUp" && !goingDown) {
          dx = 0;
          dy = -gridSize;
        }
        if (keyPressed === "ArrowDown" && !goingUp) {
          dx = 0;
          dy = gridSize;
        }
        if (keyPressed === "ArrowLeft" && !goingRight) {
          dx = -gridSize;
          dy = 0;
        }
        if (keyPressed === "ArrowRight" && !goingLeft) {
          dx = gridSize;
          dy = 0;
        }
      }

      function hasGameEnded() {
        for (let i = 1; i < snake.length; i++) {
          if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) {
            return true;
          }
        }
        const hitLeftWall = snake[0].x < 0;
        const hitRightWall = snake[0].x >= canvas.width;
        const hitTopWall = snake[0].y < 0;
        const hitBottomWall = snake[0].y >= canvas.height;
        return hitLeftWall || hitRightWall || hitTopWall || hitBottomWall;
      }

      function main() {
        if (hasGameEnded()) {
          alert("Game Over! Your score: " + score);
          return;
        }

        changingDirection = false;
        setTimeout(function onTick() {
          clearCanvas();
          drawFood();
          moveSnake();
          drawSnake();
          main();
        }, 100);
      }

      generateFood();
      document.addEventListener("keydown", changeDirection);
      main();
    </script>

    <div style="text-align: center; margin-top: 20px">
      <p>Score: <span id="score">0</span></p>
      <p>Use arrow keys to play</p>
    </div>
  </body>
</html>
